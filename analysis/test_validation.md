Test Validation
===============

Test for validation for the downloaded data using [`MODISTool` R package](https://cran.r-project.org/web/packages/MODISTools/index.html) and data coming from [Sierra Nevada Global Change Observatory](https://obsnev.es)

Prepare data
------------

``` r
#---------------------------------
machine <- 'ajpelu'
# machine <- 'ajpeluLap'
di <- paste('/Users/', machine, '/Dropbox/phd/phd_repos/modis_iv', sep='')
#---------------------------------
```

``` r
library("dplyr")
library("lubridate")
```

``` r
## obsnev_data 
obsnev <- read.csv(file=paste0(di,"/data/iv_obsnev.csv"), header=TRUE, sep=",")

## Downloade data with MODISTool 
md <- read.csv(file=paste0(di,"/data/iv_raw_2015.csv"), header=TRUE, sep=",")
```

Exploring data
--------------

``` r
head(obsnev)
```

    ##   iv_malla_modi_id      fecha  evi ndvi red  nir blue composite_day_year
    ## 1           142799 2003-12-02 1614 6641 175  867  160                332
    ## 2           142800 2003-12-02 1893 6171 272 1149  160                332
    ## 3           142801 2003-12-02 3202 7381 285 1892  141                332
    ## 4           142802 2003-12-02 3347 7677 250 1903  141                332
    ## 5           142803 2003-12-02 2621 7394 213 1422  156                332
    ## 6           142804 2003-12-02 2392 6741 275 1413  156                332
    ##         lng      lat poblacion
    ## 1 -3.265398 37.19641         1
    ## 2 -3.262782 37.19641         1
    ## 3 -3.260167 37.19641         1
    ## 4 -3.257552 37.19641         1
    ## 5 -3.254936 37.19641         1
    ## 6 -3.252321 37.19641         1

``` r
head(md)
```

    ##   modis_date id_pixel ndvi  evi pixel_reliability vi_quality
    ## 1   A2000049   142799 5327 1921                 0       2116
    ## 2   A2000065   142799 4941 2134                 0       2116
    ## 3   A2000081   142799 4739 1736                 0       2116
    ## 4   A2000097   142799 5017 2346                 0       2116
    ## 5   A2000113   142799 5010 1937                 0       2116
    ## 6   A2000129   142799 5263 2160                 0       2116
    ##   composite_day_of_the_year year       date
    ## 1                        61 2000 2000-03-01
    ## 2                        70 2000 2000-03-10
    ## 3                        91 2000 2000-03-31
    ## 4                       111 2000 2000-04-20
    ## 5                       114 2000 2000-04-23
    ## 6                       137 2000 2000-05-16

Test
----

Get all the data for a pixel (e.g. `142799`) in a year (e.g. `2000`)

``` r
myid <- 142799 
myyear <- 2001 
```

``` r
obsnev %>% 
  filter(iv_malla_modi_id == myid) %>%
  filter(
    year(ymd(fecha)) == myyear) %>% 
  arrange(composite_day_year)
```

    ##    iv_malla_modi_id      fecha  evi ndvi red  nir blue composite_day_year
    ## 1            142799 2001-01-16 1923 6229 230  990  332                 15
    ## 2            142799 2001-02-01 2009 4830 419 1202  530                 17
    ## 3            142799 2001-02-17 2991 5020 654 1973  650                 42
    ## 4            142799 2001-03-05 1824 5207 335 1063  413                 52
    ## 5            142799 2001-03-21 2845 5242 687 2201  403                 78
    ## 6            142799 2001-04-06 2101 5613 377 1342  283                 91
    ## 7            142799 2001-04-22 2276 5695 424 1546  236                100
    ## 8            142799 2001-05-08 3238 5778 649 2426  347                113
    ## 9            142799 2001-05-24 2702 5335 629 2068  337                134
    ## 10           142799 2001-06-09 3186 5758 643 2389  340                150
    ## 11           142799 2001-06-25 3498 6092 608 2504  347                165
    ## 12           142799 2001-07-11 3187 5021 933 2815  487                191
    ## 13           142799 2001-07-27 2896 4811 903 2578  472                207
    ## 14           142799 2001-08-28 2745 4941 784 2316  409                239
    ## 15           142799 2001-09-13 2561 4916 713 2092  388                246
    ## 16           142799 2001-09-29 2452 4393 850 2182  494                257
    ## 17           142799 2001-10-31 2502 5756 470 1745  244                298
    ## 18           142799 2001-11-16 1925 5812 321 1212  209                312
    ## 19           142799 2001-12-18 1561 6908 143  782  188                338
    ## 20           142799 2001-01-02 2600 6231 374 1611  262                353
    ##          lng      lat poblacion
    ## 1  -3.265398 37.19641         1
    ## 2  -3.265398 37.19641         1
    ## 3  -3.265398 37.19641         1
    ## 4  -3.265398 37.19641         1
    ## 5  -3.265398 37.19641         1
    ## 6  -3.265398 37.19641         1
    ## 7  -3.265398 37.19641         1
    ## 8  -3.265398 37.19641         1
    ## 9  -3.265398 37.19641         1
    ## 10 -3.265398 37.19641         1
    ## 11 -3.265398 37.19641         1
    ## 12 -3.265398 37.19641         1
    ## 13 -3.265398 37.19641         1
    ## 14 -3.265398 37.19641         1
    ## 15 -3.265398 37.19641         1
    ## 16 -3.265398 37.19641         1
    ## 17 -3.265398 37.19641         1
    ## 18 -3.265398 37.19641         1
    ## 19 -3.265398 37.19641         1
    ## 20 -3.265398 37.19641         1

``` r
md %>%
  filter(id_pixel == myid) %>%
  filter(year %in% myyear)
```

    ##    modis_date id_pixel ndvi  evi pixel_reliability vi_quality
    ## 1    A2001001   142799 6229 1923                 1      34841
    ## 2    A2001017   142799 4830 2009                 1      34841
    ## 3    A2001033   142799 5020 2991                 1      34965
    ## 4    A2001049   142799 5207 1824                 1      34961
    ## 5    A2001065   142799 5242 2845                 1       2189
    ## 6    A2001081   142799 5613 2101                 0       2116
    ## 7    A2001097   142799 5695 2276                 0       2116
    ## 8    A2001113   142799 5778 3238                 0       2116
    ## 9    A2001129   142799 5335 2702                 0       2116
    ## 10   A2001145   142799 5758 3186                 0       2116
    ## 11   A2001161   142799 6092 3498                 1      34965
    ## 12   A2001177   142799 5021 3187                 0       2116
    ## 13   A2001193   142799 4811 2896                 0       2116
    ## 14   A2001209   142799 5067 3106                 0       2120
    ## 15   A2001225   142799 4941 2745                 0       2116
    ## 16   A2001241   142799 4916 2561                 0       2116
    ## 17   A2001257   142799 4393 2452                 0       2116
    ## 18   A2001273   142799 5678 2333                 0       2120
    ## 19   A2001289   142799 5756 2502                 0       2120
    ## 20   A2001305   142799 5812 1925                 0       2116
    ## 21   A2001321   142799 6548 1422                 1      34897
    ## 22   A2001337   142799 6908 1561                 0       2120
    ## 23   A2001353   142799 7168 2166                 1      34897
    ##    composite_day_of_the_year year       date
    ## 1                         15 2001 2001-01-15
    ## 2                         17 2001 2001-01-17
    ## 3                         42 2001 2001-02-11
    ## 4                         52 2001 2001-02-21
    ## 5                         78 2001 2001-03-19
    ## 6                         91 2001 2001-04-01
    ## 7                        100 2001 2001-04-10
    ## 8                        113 2001 2001-04-23
    ## 9                        134 2001 2001-05-14
    ## 10                       150 2001 2001-05-30
    ## 11                       165 2001 2001-06-14
    ## 12                       191 2001 2001-07-10
    ## 13                       207 2001 2001-07-26
    ## 14                       218 2001 2001-08-06
    ## 15                       239 2001 2001-08-27
    ## 16                       246 2001 2001-09-03
    ## 17                       257 2001 2001-09-14
    ## 18                       274 2001 2001-10-01
    ## 19                       298 2001 2001-10-25
    ## 20                       312 2001 2001-11-08
    ## 21                       335 2001 2001-12-01
    ## 22                       338 2001 2001-12-04
    ## 23                       360 2001 2001-12-26
