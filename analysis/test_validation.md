Test Validation
===============

Test for validation for the downloaded data using [`MODISTool` R package](https://cran.r-project.org/web/packages/MODISTools/index.html) and data coming from [Sierra Nevada Global Change Observatory](https://obsnev.es)

Prepare data
------------

``` r
#---------------------------------
machine <- 'ajpelu'
# machine <- 'ajpeluLap'
di <- paste('/Users/', machine, '/Dropbox/phd/phd_repos/modis_iv', sep='')
#---------------------------------
```

``` r
library("dplyr")
library("lubridate")
```

``` r
## obsnev_data 
obsnev <- read.csv(file=paste0(di,"/data/iv_obsnev.csv"), header=TRUE, sep=",")

## Downloade data with MODISTool 
md <- read.csv(file=paste0(di,"/data/iv_raw_2015.csv"), header=TRUE, sep=",")
```

Exploring data
--------------

``` r
head(obsnev)
```

    ##   iv_malla_modi_id      fecha  evi ndvi red  nir blue composite_day_year
    ## 1           142799 2003-12-02 1614 6641 175  867  160                332
    ## 2           142800 2003-12-02 1893 6171 272 1149  160                332
    ## 3           142801 2003-12-02 3202 7381 285 1892  141                332
    ## 4           142802 2003-12-02 3347 7677 250 1903  141                332
    ## 5           142803 2003-12-02 2621 7394 213 1422  156                332
    ## 6           142804 2003-12-02 2392 6741 275 1413  156                332
    ##         lng      lat poblacion
    ## 1 -3.265398 37.19641         1
    ## 2 -3.262782 37.19641         1
    ## 3 -3.260167 37.19641         1
    ## 4 -3.257552 37.19641         1
    ## 5 -3.254936 37.19641         1
    ## 6 -3.252321 37.19641         1

``` r
head(md)
```

    ##   modis_date id_pixel ndvi  evi pixel_reliability vi_quality
    ## 1   A2000049   142799 5327 1921                 0       2116
    ## 2   A2000065   142799 4941 2134                 0       2116
    ## 3   A2000081   142799 4739 1736                 0       2116
    ## 4   A2000097   142799 5017 2346                 0       2116
    ## 5   A2000113   142799 5010 1937                 0       2116
    ## 6   A2000129   142799 5263 2160                 0       2116
    ##   composite_day_of_the_year year       date
    ## 1                        61 2000 2000-03-01
    ## 2                        70 2000 2000-03-10
    ## 3                        91 2000 2000-03-31
    ## 4                       111 2000 2000-04-20
    ## 5                       114 2000 2000-04-23
    ## 6                       137 2000 2000-05-16

Test
----

Get all the data for a pixel (e.g. `142799`) in a year (e.g. `2000`)

``` r
myid <- 142799 
myyear <- 2010 
```

``` r
obsnev %>% 
  filter(iv_malla_modi_id == myid) %>%
  filter(
    year(ymd(fecha)) == myyear) %>% 
  arrange(composite_day_year) %>% 
  select(iv_malla_modi_id, fecha, composite_day_year, evi, ndvi)
```

    ##    iv_malla_modi_id      fecha composite_day_year  evi ndvi
    ## 1            142799 2010-01-16                  6 1155 4239
    ## 2            142799 2010-02-01                 18 2125 7027
    ## 3            142799 2010-02-17                 33 1936 2498
    ## 4            142799 2010-03-05                 63 1797 5844
    ## 5            142799 2010-03-21                 74 1982 3284
    ## 6            142799 2010-04-06                 93 1864 4944
    ## 7            142799 2010-04-22                100 2037 5629
    ## 8            142799 2010-05-08                127 2597 5570
    ## 9            142799 2010-05-24                143 2943 5560
    ## 10           142799 2010-06-09                159 3081 5248
    ## 11           142799 2010-06-25                173 2867 5911
    ## 12           142799 2010-07-11                191 2953 5371
    ## 13           142799 2010-07-27                196 2586 5687
    ## 14           142799 2010-08-12                212 2272 5101
    ## 15           142799 2010-08-28                235 2320 5780
    ## 16           142799 2010-09-13                246 2204 5116
    ## 17           142799 2010-09-29                257 2751 5196
    ## 18           142799 2010-10-15                278 1937 5309
    ## 19           142799 2010-10-31                298 2253 5349
    ## 20           142799 2010-11-16                310 1923 6195
    ## 21           142799 2010-12-02                323 2184 6189
    ## 22           142799 2010-12-18                346 1477 4742
    ## 23           142799 2010-01-03                361 2574 6628

``` r
md %>%
  filter(id_pixel == myid) %>%
  filter(year %in% myyear) %>% 
  select(id_pixel, date, composite_day_of_the_year, evi, ndvi)
```

    ##    id_pixel       date composite_day_of_the_year  evi ndvi
    ## 1    142799 2010-01-06                         6 1155 4239
    ## 2    142799 2010-01-18                        18 2125 7027
    ## 3    142799 2010-02-02                        33 1936 2498
    ## 4    142799 2010-03-04                        63 1797 5844
    ## 5    142799 2010-03-15                        74 1982 3284
    ## 6    142799 2010-04-03                        93 1864 4944
    ## 7    142799 2010-04-10                       100 2037 5629
    ## 8    142799 2010-05-07                       127 2597 5570
    ## 9    142799 2010-05-23                       143 2943 5560
    ## 10   142799 2010-06-08                       159 3081 5248
    ## 11   142799 2010-06-22                       173 2867 5911
    ## 12   142799 2010-07-10                       191 2953 5371
    ## 13   142799 2010-07-15                       196 2586 5687
    ## 14   142799 2010-07-31                       212 2272 5101
    ## 15   142799 2010-08-23                       235 2320 5780
    ## 16   142799 2010-09-03                       246 2204 5116
    ## 17   142799 2010-09-14                       257 2751 5196
    ## 18   142799 2010-10-05                       278 1937 5309
    ## 19   142799 2010-10-25                       298 2253 5349
    ## 20   142799 2010-11-06                       310 1923 6195
    ## 21   142799 2010-11-19                       323 2184 6189
    ## 22   142799 2010-12-12                       346 1477 4742
    ## 23   142799 2010-12-29                       363 1655 6771
