---
title: "Display map of pixels"
author: "AJ Perez-Luque (@ajpelu)"
date: "2016 August"
output:  
  md_document:
    variant: markdown_github
---

# Test Validation 
Test for validation for the downloaded data using [`MODISTool` R package](https://cran.r-project.org/web/packages/MODISTools/index.html) and data coming from [Sierra Nevada Global Change Observatory](https://obsnev.es) 

## Prepare data 
```{r wd}
#---------------------------------
machine <- 'ajpelu'
# machine <- 'ajpeluLap'
di <- paste('/Users/', machine, '/Dropbox/phd/phd_repos/modis_iv', sep='')
#---------------------------------
```

```{r packages, warning=FALSE, message=FALSE}
library("rgdal")
library("sp")
library("raster")
library("leaflet")
library("dplyr")


# library("lubridate")
# library("printr") # To install see https://github.com/yihui/printr
# library("ggplot2")
# library("ggthemes")
# 
# 
# 
# library("raster")
# library("rasterVis")
# source(paste0(di,"/R/exportpdf.R")) # function to export raster levelplots maps as pdf
# library("dplyr")
# library("ggplot2")
# library("reshape2")
# library("purrr")
# # library("pander")
# library("knitr")

```

```{r, readData}
# Prepare spatial data 
iv <- read.csv(file=paste0(di,"/data_raw/coord_qpyr.csv"), header=TRUE, sep=",")


# Create a spatial dataframe 
iv_sp <- SpatialPointsDataFrame(coords = iv[,c('lng','lat')], data = iv,
                               proj4string = CRS("+init=epsg:4326"))

# Transform 
aux_spatial <- spTransform(iv_sp, CRS("+init=epsg:23030"))

# raster auxiliar 
aux_rast <- raster(aux_spatial, resolution=250)

# Rasterize 
my_raster <- rasterize(aux_spatial, aux_rast, "iv_malla_modi_id", mean)
names(my_raster) <- "iv_malla_modi_id" 
 
# reproject 
r<- projectRaster(my_raster, crs=crs("+init=epsg:4326"))
plot(r)

# Raster to polygon 
qp <- rasterToPolygons(r)

qp <- sp::merge(x=qp, y=iv, by="iv_malla_modi_id")


```


```{r}
leaflet() %>% 
  addTiles(urlTemplate = "http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png") %>%
  addPolygons(data = qp, fillColor = qp@data$layer)
              
              
              popup = paste0("Id Pixel: ", as.character(wrs2$PATH_ROW)), group = "Landsat scenes")
#   addProviderTiles("Esri.WorldTopoMap")


# # SEE some urls: 
# http://amsantac.co/blog/en/r/2015/08/11/leaflet-R.html
# http://spatialrecology.org/posts/leafletmapping.html
# https://rstudio.github.io/leaflet/basemaps.html

  addTiles() %>% 
leaflet(neStates) %>%
  addPolygons(
    stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5,
    color = ~colorQuantile("YlOrRd", states$AWATER)(AWATER)
  )



// https: also suppported.
var Esri_WorldTopoMap = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community'
});
